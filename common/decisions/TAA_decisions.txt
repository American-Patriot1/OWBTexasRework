#needed road 9719 to 9725 and 11483 to 11490 to 11498 to 11502
GDH_market_decision_view = {
	GDH_upgrade_marketed_technology = {
		icon = generic_ignite_civil_war
		visible = {
			always = yes
		}
		ai_will_do = {
			factor = 45
		}
		available = {
			custom_trigger_tooltip = {
				if = {
					limit = {
						has_tech = ballistic_weaponry_tech_1
					}
					NOT = { has_country_flag = selling_ballistic_weaponry_1 }
				}
				else_if = {
					limit = {
						has_tech = ballistic_weaponry_tech_2
					}
					NOT = { has_country_flag = selling_ballistic_weaponry_2 }
				}
				else_if = {
					limit = {
						has_tech = ballistic_weaponry_tech_3
					}
					NOT = { has_country_flag = selling_ballistic_weaponry_3 }
				}
				else = {
					always = no
				}
				tooltip = ghd_update_market_technology
			}
		}
		custom_cost_trigger = {
			set_temp_variable = {
				temp_cap_cost = 150
			}
			custom_caps_cost_trigger = yes
		}
		custom_cost_text = "caps_decisions_cost_text"
		complete_effect = {
			set_temp_variable = { caps_to_add = -150 }
			add_caps = yes
			add_to_variable = {
				gdh_base_factory_ratio = -10
			}
			clamp_variable = {
				var = gdh_base_factory_ratio
				min = 5
			}
			if = {
				limit = {
					GDH = {
						has_country_flag = selling_ballistic_weaponry_2
					}
				}
				set_country_flag = selling_ballistic_weaponry_3
			}
			else_if = {
				limit = {
					GDH = {
						has_country_flag = selling_ballistic_weaponry_1
					}
				}
				set_country_flag = selling_ballistic_weaponry_2
			}
			else_if = {
				limit = {
					GDH = {
						has_country_flag = selling_standard_weaponry
					}
				}
				set_country_flag = selling_ballistic_weaponry_1
			}
			custom_effect_tooltip = gdh_upgrade_equipment_tt
		}
	}
}
@AI_FAIR_PRICE_RATIO = 10
GDH_market_consumer_view = {
	GDH_purchase_weaponry_1 = {
		icon = generic_ignite_civil_war
		ai_will_do = {
			base = @AI_FAIR_PRICE_RATIO
			modifier = {
				add = -1
				GDH = {
					has_country_flag = selling_ballistic_weaponry_1
				}
			}
			modifier = {
				set_temp_variable = {
					temp_ai_weight = GDH.gdh_weaponry_sell_price
				}
				if = {
					limit = {
						NOT = {
							check_variable = { caps_income?1 = 0 }
						}
					}
					divide_temp_variable = { temp_ai_weight = caps_income?1 }
				}
				multiply_temp_variable = {
					var = temp_ai_weight
					value = -1
				}
				add = temp_ai_weight
			}
			modifier = {
				stockpile_ratio = {
					archetype = infantry_equipment
					ratio > 0.8
				}
				add = -7
			}
		}
		custom_cost_trigger = {
			set_temp_variable = {
				temp_cap_cost = GDH.gdh_weaponry_sell_price
			}
			custom_caps_cost_trigger = yes
		}
		custom_cost_text = "caps_decisions_cost_text"
		visible = {
			has_country_flag = gdh_market_country_available
		}
		available = {
			custom_trigger_tooltip = {
				tooltip = gdh_minimum_stock
				check_variable = { GDH.gdh_current_stock > 150 }
			}
		}
		complete_effect = {
			ROOT = {
				add_equipment_to_stockpile = {
					type = infantry_equipment_1
					amount = 150
					producer = GDH
				}
			}
			set_temp_variable = { equipment_cost = GDH.gdh_weaponry_sell_price }
			set_temp_variable = { caps_to_add = equipment_cost }
			multiply_temp_variable = { caps_to_add = -1 }
			add_caps = yes
			GDH = {
				subtract_from_variable = { gdh_current_stock = 150 }
				set_temp_variable = { caps_to_add = equipment_cost }
				add_caps = yes
			}
		}
		days_remove = 25
	}
	GDH_purchase_weaponry_2 = {
		icon = generic_ignite_civil_war
		ai_will_do = {
			base = @AI_FAIR_PRICE_RATIO
			modifier = {
				add = 1
				GDH = {
					has_country_flag = selling_ballistic_weaponry_1
				}
			}
			modifier = {
				set_temp_variable = {
					temp_ai_weight = GDH.gdh_weaponry_sell_price
				}
				if = {
					limit = {
						NOT = {
							check_variable = { caps_income?1 = 0 }
						}
					}
					divide_temp_variable = { temp_ai_weight = caps_income?1 }
				}
				multiply_temp_variable = {
					var = temp_ai_weight
					value = -1
				}
				add = temp_ai_weight
			}
			modifier = {
				stockpile_ratio = {
					archetype = infantry_equipment
					ratio > 0.8
				}
				add = -7
			}
		}
		custom_cost_trigger = {
			set_temp_variable = {
				temp_cap_cost = GDH.gdh_weaponry_sell_price
			}
			custom_caps_cost_trigger = yes
		}
		custom_cost_text = "caps_decisions_cost_text"
		visible = {
			has_country_flag = gdh_market_country_available
			GDH = {
				has_country_flag = selling_ballistic_weaponry_1
			}
		}
		available = {
			check_variable = { GDH.gdh_current_stock > 150 }
		}
		complete_effect = {
			ROOT = {
				add_equipment_to_stockpile = {
					type = ballistic_equipment_1
					amount = 150
					producer = GDH
				}
			}
			set_temp_variable = { equipment_cost = GDH.gdh_weaponry_sell_price }
			set_temp_variable = { caps_to_add = equipment_cost }
			multiply_temp_variable = { caps_to_add = -1 }
			add_caps = yes
			GDH = {
				subtract_from_variable = { gdh_current_stock = 150 }
				set_temp_variable = { caps_to_add = equipment_cost }
				add_caps = yes
			}
		}
		days_remove = 25
	}
	GDH_purchase_weaponry_3 = {
		icon = generic_ignite_civil_war
		ai_will_do = {
			base = @AI_FAIR_PRICE_RATIO
			modifier = {
				add = 3
				has_country_flag = selling_ballistic_weaponry_2
			}
			modifier = {
				set_temp_variable = {
					temp_ai_weight = GDH.gdh_weaponry_sell_price
				}
				if = {
					limit = {
						NOT = {
							check_variable = { caps_income?1 = 0 }
						}
					}
					divide_temp_variable = { temp_ai_weight = caps_income?1 }
				}
				multiply_temp_variable = {
					var = temp_ai_weight
					value = -1
				}
				add = temp_ai_weight
			}
			modifier = {
				stockpile_ratio = {
					archetype = infantry_equipment
					ratio > 0.8
				}
				add = -7
			}
		}
		custom_cost_trigger = {
			set_temp_variable = {
				temp_cap_cost = GDH.gdh_weaponry_sell_price
			}
			custom_caps_cost_trigger = yes
		}
		custom_cost_text = "caps_decisions_cost_text"
		visible = {
			has_country_flag = gdh_market_country_available
			GDH = {
				has_country_flag = selling_ballistic_weaponry_2
			}
		}
		available = {
			check_variable = { GDH.gdh_current_stock > 150 }
		}
		complete_effect = {
			ROOT = {
				add_equipment_to_stockpile = {
					type = ballistic_equipment_2
					amount = 150
					producer = GDH
				}
			}
			set_temp_variable = { equipment_cost = GDH.gdh_weaponry_sell_price }
			set_temp_variable = { caps_to_add = equipment_cost }
			multiply_temp_variable = { caps_to_add = -1 }
			add_caps = yes
			GDH = {
				subtract_from_variable = { gdh_current_stock = 150 }
				set_temp_variable = { caps_to_add = equipment_cost }
				add_caps = yes
			}
		}
		days_remove = 25
	}
	GDH_purchase_weaponry_4 = {
		icon = generic_ignite_civil_war
		ai_will_do = {
			base = @AI_FAIR_PRICE_RATIO
			modifier = {
				add = 6
				has_country_flag = selling_ballistic_weaponry_2
			}
			modifier = {
				set_temp_variable = {
					temp_ai_weight = GDH.gdh_weaponry_sell_price
				}
				if = {
					limit = {
						NOT = {
							check_variable = { caps_income?1 = 0 }
						}
					}
					divide_temp_variable = { temp_ai_weight = caps_income?1 }
				}
				multiply_temp_variable = {
					var = temp_ai_weight
					value = -1
				}
				add = temp_ai_weight
			}
			modifier = {
				stockpile_ratio = {
					archetype = infantry_equipment
					ratio > 0.8
				}
				add = -7
			}
		}
		custom_cost_trigger = {
			set_temp_variable = {
				temp_cap_cost = GDH.gdh_weaponry_sell_price
			}
			custom_caps_cost_trigger = yes
		}
		custom_cost_text = "caps_decisions_cost_text"
		visible = {
			has_country_flag = gdh_market_country_available
			GDH = {
				has_country_flag = selling_ballistic_weaponry_3
			}
		}
		available = {
			check_variable = { GDH.gdh_current_stock > 150 }
		}
		complete_effect = {
			ROOT = {
				add_equipment_to_stockpile = {
					type = ballistic_equipment_3
					amount = 150
					producer = GDH
				}
			}
			set_temp_variable = { equipment_cost = GDH.gdh_weaponry_sell_price }
			set_temp_variable = { caps_to_add = equipment_cost }
			multiply_temp_variable = { caps_to_add = -1 }
			add_caps = yes
			GDH = {
				subtract_from_variable = { gdh_current_stock = 150 }
				set_temp_variable = { caps_to_add = equipment_cost }
				add_caps = yes
			}
		}
		days_remove = 25
	}
}
